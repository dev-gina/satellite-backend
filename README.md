# 위성 영상 처리 백엔드 - 이진아

## 1. 프로젝트 개요
- S3에 저장된 원본 TIFF 영상을 COG (Cloud Optimized GeoTIFF) 포맷으로 변환
- 메타데이터를 DB에 저장, 변환된 영상은 다시 S3에 업로드
- 단건/다건 변환 처리, 메타데이터 조회 및 검색 API 제공


--------------------------------------------------------------------------------------


## 2. 기술 스택
- Java 17
- Spring Boot 3
- Gradle
- AWS S3 SDK
- GDAL (CLI 기반)
- JPA (Spring Data)
- H2 (인메모리 테스트 DB)
- Swagger


--------------------------------------------------------------------------------------


## 3. 주요 프로젝트 구조
- 단일 모듈 구성
- 패키지 구조 : config / controller / dto / model / repository / service
- `Config` : 설정 관련
- `Controller` : REST API 엔드포인트 정의
- `DTO` : 요청/응답 데이터 구조 정의
- `Model` : db 모델 정의
- `Repository` : DB 접근 처리
- `Service` : 비즈니스 로직 처리 (S3 접근, GDAL 변환 등)


--------------------------------------------------------------------------------------


## 4. 실행 방법
```bash
./gradlew bootRun
```
- **H2 DB 확인**: [http://localhost:8080/h2-console](http://localhost:8080/h2-console)  

- **S3 파일 조회(S3 명령어)**:
```bash
aws s3 ls s3://dev1-apne2-pre-test-tester-bucket/tester-LeeJina-1744854818/
```


--------------------------------------------------------------------------------------


## 5. API 요약

| 기능              | URL                                   | 메서드 | 설명                         |
|-------------------|----------------------------------------|--------|------------------------------|
| S3 파일 조회       | `/satellite-images/source-list`        | GET    | S3에서 TIFF 파일 목록 조회   |
| 메타데이터 저장    | `/satellite-images/metadata`           | POST   | DB에 메타데이터 저장         |
| COG 변환 + 업로드 | `/satellite-images/upload`             | POST   | GDAL 변환 + S3 업로드        |
| 메타데이터 조회    | `/satellite-images/metadata/{id}`      | GET    | ID로 메타데이터 조회         |
| 메타데이터 검색    | `/satellite-images/search`             | GET    | 요청 조건에 따라 검색        |



--------------------------------------------------------------------------------------


## 6. Swagger 예시 및 에러 코드
- Swagger UI 접속 : http://localhost:8080/swagger-ui/index.html
- 예시 1. GET /satellite-images/source-list

[
  {
    "name": "093_2016.tif",
    "width": 0,
    "height": 0,
    "bandCount": 0,
    "remoteUrl": "https://.../093_2016.tif",
    "userName": null,
    "sequence": 0,
    "cogPath": null
  },
  ...
]


*** 에러 응답 예시 ***

{
  "timestamp": "2025-04-24T12:34:56",
  "status": 404,
  "error": "Not Found",
  "message": "파일을 찾을 수 없습니다.",
  "path": "/satellite-images/source-list"
}

사용된 응답 코드: 200, 404, 500
Swagger 상에서 각각의 응답 코드와 포맷 확인 가능


--------------------------------------------------------------------------------------


## 7. GDAL 변환 처리
- GDAL CLI를 Java의 ProcessBuilder를 통해 실행
- gdal_translate -of COG input.tif output.tif
- S3에서 다운로드 > GDAL 변환 > S3 업로드


--------------------------------------------------------------------------------------


## 8. 테스트 환경
- PU: Intel(R) Core(TM) i7-1360P
- RAM: 16GB
- OS: Windows 11


--------------------------------------------------------------------------------------


## 9. 아키텍쳐 흐름
1. 위성 사진을 변환하는 프로그램 개발
- 원본 위성 영상 파일이 S3(아마존 저장소)에 저장되어 있음
- 그 파일을 "COG"라는 특별한 포맷으로 변환

2. 변환한 파일을 다른 S3 저장소에 다시 올려야함
- 변환한 이미지를 정해진 규칙 이름으로 다시 저장
ex. testscene-to-cog-1.tiff

3. 영상 정보(메타데이터)를 DB에 저장
- 변환한 파일의 정보(width, height 등)
- H2 데이터베이스에 사용하여 관리

4. API를 만들어야함
- 단 건 변환 API : 한건만 변환
- 다건 변환 API : 다건 변환
- 메타데이터 조회 API : 변환된 파일 정보를 검색/조회 가능


--------------------------------------------------------------------------------------


## 10. 클라우드 배포 시 아키텍처 설계 (예상)
만약 이 서비스를 Public Cloud(AWS 등)에 배포한다면?

- 사용자는 API를 호출합니다 (예: 파일 목록 조회, 변환 요청).
- API Gateway가 요청을 받아 Spring Boot 서버로 전달합니다.
- Spring 서버는 S3에서 파일을 가져오고, GDAL로 변환한 뒤 다시 S3에 저장합니다.
- 변환된 영상의 정보(메타데이터)는 데이터베이스에 저장됩니다.


--------------------------------------------------------------------------------------


## 11. Reactive Programming 사용 여부
- WebFlux 등 Reactive 기술은 사용하지 않음
- Spring MVC 기반 동기 처리 방식 사용


--------------------------------------------------------------------------------------


## 12. JAR 파일 제공 여부 
- 본 프로젝트는 GDAL CLI 실행 기반으로, JAR 실행이 아닌 CLI 환경에서 동작
- java -jar project.jar 실행은 필요 없음


--------------------------------------------------------------------------------------


## 13. 예상 면접 질문

1. COG 변환을 어떻게 처리했나요? (GDAL 사용 방식 및 처리 흐름)
→ GDAL의 CLI 도구를 활용해 처리했습니다.
   TIFF 파일을 S3 에서 다운로드 > GDAL로 COG 변환 > 변환된 파일을 다시 S3에 업로드 하는 흐름 입니다.


2. S3 내 동일 파일명이 존재할 경우 어떻게 중복을 방지했나요? (시퀀스 증가 방식)
→ 파일명에 시퀀스를 붙이는 방식으로 중복을 방지했습니다.
   기존 파일들을 조회해 가장 높은 번호를 찾아 +1 시퀀스로 새 이름을 만들었습니다.


3. 실제 운영 환경에서 이 API의 성능 병목은 어떤 부분에서 발생할 수 있나요?
→ 주요 병목은 다음 세 가지 입니다.
   1. GDAL 변환 : 외부 CLI 호출이라 속도나 병렬 처리에 한계가 있음
   2. S3 업로드 : 대용량 파일은 업로드 시간이 오래 걸림
   3. DB 저장 : 대량 데이터 저장 시 트랜잭션 처리 속도가 이슈될 수 있음


--------------------------------------------------------------------------------------